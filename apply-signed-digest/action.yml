name: SignTool signed digest applicator
description: Attach a signed digest to a file
author: tim-seves
inputs:
  artifact:
    description: The artifact generated by generate-digest
    required: true
  path:
    description: file to sign with the signed-digest
    required: true
  signed-digest:
    description: Signed digest produced by the sign-digest workflow
runs:
  using: composite
  steps:
  - uses: actions/download-artifact@v4
    with:
      name: ${{ inputs.artifact }}

  - id: tidyup-tmp
    uses: geekyeggo/delete-artifact@v5
    with:
      name: ${{ inputs.artifact }}
  
  - id: apply-signed-digest
    shell: pwsh
    env:
      signtool: C:/"Program Files (x86)"/"Windows Kits"/10/bin/10.0.17763.0/x86/signtool.exe
    run: |
      Set-Content -Path ${{inputs.path}}.dig.signed -Value '${{ inputs.signed-digest }}'
      ${{env.signtool}} sign /di . /v ${{inputs.path}}
